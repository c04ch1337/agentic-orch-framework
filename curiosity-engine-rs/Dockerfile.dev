FROM rust:1.70 as builder

WORKDIR /usr/src/app
COPY . .

# Build only this service's dependencies
RUN cargo build --package curiosity-engine-rs

# Runtime image
FROM debian:bullseye-slim

# Install necessary runtime dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends libssl-dev ca-certificates && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY --from=builder /usr/src/app/target/debug/curiosity-engine-rs /app/

# Expose service port
EXPOSE 50076

# Run the service
CMD ["./curiosity-engine-rs"]